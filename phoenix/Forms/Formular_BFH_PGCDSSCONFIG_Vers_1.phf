[BEGINEXPORT]
##FORM
BFH_PGCDSSCONFIG¦1¦¦F¦147.87.117.94¦nKISDev¦06.12.2017 16:33:30¦25
#FORMACL
220000000000000000002000002020222200000022222000002000000020000000000000000000000000000000000000000000000000002222222000000000000000000000000000000002200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#FORMPROPERTY
A0:x=597,y=58,w=1126,h=607,v=0,blnUseSysHeader=1,pgFormat=0;
#ONENTER
{**
 * =================================================================== 
 *
 *    Copyright (c) 2017 Marwin Philips (MAP) & Kevin Tippenhauer (TIK), Bachelorthesis Medizininformatik
 *
 *
 *    Project: BA Thesis Pharmakogenetic CDSS
 * ===================================================================
 *
 * @context Form : BFH_PGCDSSCONFIG.OnEnter
 * 
 * ===================================================================
 * @created  		18.11.2017 MAP
 * @see      		Referenzen_auf_weitere_Infos
 * @edit     		Aenderungsdatum_und_Ersteller                
 * @Info        Formular für die Konfiguration von Warnmeldungen.
 *
 *}
CallLocal('loadGeneAgents')
#FORMVARS
$guiTable=BFH_PGCDSSCONFIG
$warnungenTable=BFH_WARNING
$GWPTable=BFH_GENEAGENTTOPRODUCT
$genWirkstoffTable=BFH_GENEAGENT
$geneAgents=
%metabolizerCodeTable=30000
#FORMSCRIPTS
=*setGenWirkstoffKombination=$gen = GetFormField($genWirkstoffTable, 'GENE_E')<%br%>$wirkstoff = GetFormField($genWirkstoffTable, 'AGENT_E')<%br%>$kombo = '<$gen> / <$wirkstoff>'<%br%>PutFormField($genWirkstoffTable, 'GENEAGENT_E', $kombo)
=*loadGeneAgents=clearMemo(£geneAgents)<%br%>%size = RecordNumber($genWirkstoffTable)<%br%>if(%size > 0 )<%br%>  %i = 1<%br%>  loop<%br%>    $name = GetFormField($genWirkstoffTable, 'GENEAGENT_E', %i)<%br%>    %id = GetFormField($genWirkstoffTable, 'GENEAGENT_N', %i)<%br%>    Append(£geneAgents,'<%id>=<$name>')<%br%>    inc(%i)<%br%>  until(%i > %size)<%br%>  $geneAgents = £geneAgents<%br%>else<%br%>  $geneAgents =''<%br%>endif<%br%><%br%>SetItems($warnungenTable, 'GENEAGENT_C', £geneAgents)<%br%>SetItems($GWPTable, 'GENEAGENT_C', £geneAgents)
#_FORMEND
##TABLE
T1:n=BFH_PGCDSSCONFIG,virtual=1,o=0,l=0;
#TABLEACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_TABLEEND
##TABLE
T2:n=BFH_WARNING,PKKind=3,PKFields="WARNING_N",UseStdFormFields=0,o=1,l=0;
#TABLEACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#ONBEFOREREAD
SetFilter('BFH_WARNING', '1=1', #ftPrimary, 'GENEAGENT_E asc, METABOLIZER_C asc')
#_TABLEEND
##TABLE
T3:n=BFH_GENEAGENT,PKKind=3,PKFields="GENEAGENT_N",UseStdFormFields=0,o=1,l=0;
#TABLEACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#ONBEFOREREAD
SetFilter('BFH_GENEAGENT','1=1', #ftPrimary, 'GENEAGENT_E asc')
#_TABLEEND
##TABLE
T4:n=BFH_GENEAGENTTOPRODUCT,PKKind=3,PKFields="GENEAGENTTOPRODUCT_N",UseStdFormFields=0,o=1,l=0;
#TABLEACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#ONBEFOREREAD
SetFilter('BFH_GENEAGENTTOPRODUCT','1=1', #ftPrimary, 'GENEAGENT_E asc')
#_TABLEEND
##FIELD
O2:x=0,y=30,h=495,w=1062,alignment="N",parent="K1WARNING",l=13,o=0,nvg=4,arp=0,sdv=1,recclmd=0,reccl=0,r=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#ONRECACTIVE
£geneAgents = $geneAgents
SetItems($warnungenTable, 'GENEAGENT_C', £geneAgents)
#ONINSERT
%id = GenNewID('BFHWARNING')
PutFormField($warnungenTable, 'WARNING_N', %id)
#_FIELDEND
##FIELD
O4:x=0,y=30,h=484,w=852,alignment="N",parent="K1GENEAGENTTOPRODUCT",l=13,o=0,nvg=4,arp=0,sdv=1,recclmd=0,reccl=0,r=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#ONRECACTIVE
£geneAgents = $geneAgents
SetItems($GWPTable, 'GENEAGENT_C', £geneAgents)
#ONINSERT
%id = GenNewID('BFHGENEAGENTTOPRODUCT')
PutFormField($GWPTable, 'GENEAGENTTOPRODUCT_N', %id)
#_FIELDEND
##FIELD
O3:x=0,y=30,h=480,w=735,alignment="N",parent="K1GENEAGENT",l=13,o=0,nvg=4,arp=0,sdv=1,recclmd=0,reccl=0,r=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#ONINSERT
%id = GenNewID('BFHGENEAGENT')
PutFormField($genWirkstoffTable, 'GENEAGENT_N', %id)
#_FIELDEND
##FIELD
J1:x=5,y=10,h=560,w=1111,alignment="N",f=CONFIG,virtual=0,r=8,mline=0,v=0,l=0,a=0,i=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#ONCHANGE
CallLocal('loadGeneAgents')
#_FIELDEND
##FIELD
K1:x=4,y=27,h=529,w=1103,anchors="LTRB",alignment="C",parent="J1CONFIG",pagecontrol="J1CONFIG",f=WARNING,virtual=0,c="Warnungen",v=0,tv=1,pi=0,tc=0,ti=;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
C2:x=5,y=5,h=24,w=180,alignment="N",parent="_O2BFH_WARNING_MRO",f=GENEAGENT_C,virtual=1,r=0,o=0,l=0,dm=0,v=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#LIST
#ONCHANGE
%id = GetFormField($warnungenTable, 'GENEAGENT_C')
£geneAgents = $geneAgents
$name = GetNamedValue(£geneAgents, '<%id>')
PutFormField($warnungenTable, 'GENEAGENT_N', %id)
PutFormField($warnungenTable, 'GENEAGENT_E', $name)
#_FIELDEND
##FIELD
N2:x=5,y=5,h=24,w=90,alignment="N",parent="_O2BFH_WARNING_MRO",f=GENEAGENT_N,r=6,l=2,inc=1,v=1;
#FIELDACL
440000000000000000004000004040444400000044444000004000000040000000000000000000000000000000000000000000000000004444444000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
C2:x=195,y=5,h=24,w=135,alignment="N",parent="_O2BFH_WARNING_MRO",f=METABOLIZER_C,r=1,o=16724,l=-1,dm=0,v=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#LIST
16724|Metabolizer|||
1|Ultrarapid Metabolizer||||||||LA10315-2
2|Rapid Metabolizer||||||||LA25390-8
3|Normal Metabolizer||||||||LA25391-6
4|Intermediate Metabolizer||||||||LA10317-8
5|Poor Metabolizer||||||||LA9657-3
#_FIELDEND
##FIELD
M2:x=340,y=5,h=27,w=200,alignment="N",parent="_O2BFH_WARNING_MRO",f=WARNINGTEXTINFO_M,r=2,l=1,v=0,AutoGrow=0,fontdlg=,SpeechProcessing=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#LIST
#_FIELDEND
##FIELD
M2:x=550,y=5,h=27,w=200,alignment="N",parent="_O2BFH_WARNING_MRO",f=WARNINGTEXTACTION_M,r=3,l=1,v=0,AutoGrow=0,fontdlg=,SpeechProcessing=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#LIST
#_FIELDEND
##FIELD
E2:x=760,y=5,h=24,w=200,alignment="N",parent="_O2BFH_WARNING_MRO",f=INFOURL_E,r=4,v=0,l=200,m=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#LIST
#_FIELDEND
##FIELD
N2:x=970,y=5,h=22,w=62,alignment="N",parent="_O2BFH_WARNING_MRO",f=WARNING_N,r=5,l=2,inc=1,v=1,color=8421376;
#FIELDACL
040000000000000000004000004040444400000044444000004000000040000000000000000000000000000000000000000000000000004444444000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
E2:x=5,y=5,h=24,w=163,alignment="N",parent="_O2BFH_WARNING_MRO",f=GENEAGENT_E,r=7,v=0,l=40,m=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#LIST
#_FIELDEND
##FIELD
K1:x=4,y=27,h=529,w=1103,anchors="LTRB",alignment="C",parent="J1CONFIG",pagecontrol="J1CONFIG",f=GENEAGENTTOPRODUCT,virtual=0,c="Gen und Wirkstoff mit Produkt verknüpfen",v=0,tv=1,pi=1,tc=0,ti=;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
C4:x=5,y=5,h=24,w=180,alignment="N",parent="_O4BFH_GENEAGENTTOPRODUCT_MRO",f=GENEAGENT_C,virtual=1,r=0,o=0,l=0,dm=0,v=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#LIST
#ONCHANGE
%id = GetFormField($GWPTable, 'GENEAGENT_C')
£geneAgents = $geneAgents
$name = GetNamedValue(£geneAgents, '<%id>')
PutFormField($GWPTable, 'GENEAGENT_N', %id)
PutFormField($GWPTable, 'GENEAGENT_E', $name)
#_FIELDEND
##FIELD
N4:x=5,y=5,h=24,w=121,alignment="N",parent="_O4BFH_GENEAGENTTOPRODUCT_MRO",f=GENEAGENT_N,r=3,l=2,inc=1,v=1;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
S4:x=210,y=5,h=24,w=555,alignment="N",parent="_O4BFH_GENEAGENTTOPRODUCT_MRO",f=PRODUCTIDENTIFIER_S,r=1,o=3,s=MEDIKAMENT,l=5;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
N4:x=775,y=5,h=24,w=61,alignment="N",parent="_O4BFH_GENEAGENTTOPRODUCT_MRO",f=GENEAGENTTOPRODUCT_N,r=2,l=2,inc=1,v=1,color=8421376;
#FIELDACL
040000000000000000004000004040444400000044444000004000000040000000000000000000000000000000000000000000000000004444444000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
E4:x=5,y=5,h=24,w=163,alignment="N",parent="_O4BFH_GENEAGENTTOPRODUCT_MRO",f=GENEAGENT_E,r=4,v=0,l=40,m=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#LIST
#_FIELDEND
##FIELD
K1:x=4,y=27,h=529,w=1103,anchors="LTRB",alignment="C",parent="J1CONFIG",pagecontrol="J1CONFIG",f=GENEAGENT,virtual=0,c="Gen und Wirkstoff definieren",v=0,tv=1,pi=2,tc=0,ti=;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
E3:x=5,y=5,h=24,w=145,alignment="N",parent="_O3BFH_GENEAGENT_MRO",f=GENE_E,r=0,v=0,l=40,m=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#LIST
#ONCHANGE
callLocal('setGenWirkstoffKombination')
#ONEXIT
callLocal('setGenWirkstoffKombination')
#_FIELDEND
##FIELD
E3:x=155,y=5,h=24,w=165,alignment="N",parent="_O3BFH_GENEAGENT_MRO",f=AGENT_E,r=1,v=0,l=60,m=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#LIST
#ONCHANGE
callLocal('setGenWirkstoffKombination')
#ONEXIT
callLocal('setGenWirkstoffKombination')
#_FIELDEND
##FIELD
N3:x=665,y=5,h=24,w=42,alignment="N",parent="_O3BFH_GENEAGENT_MRO",f=GENEAGENT_N,r=2,l=2,inc=1,v=1,color=8421376;
#FIELDACL
040000000000000000004000004040444400000044444000004000000040000000000000000000000000000000000000000000000000004444444000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
E3:x=330,y=5,h=24,w=330,alignment="N",parent="_O3BFH_GENEAGENT_MRO",f=GENEAGENT_E,r=3,v=0,l=100,m=0,color=8454143;
#FIELDACL
220000000000000000002000002020222200000022222000002000000020000000000000000000000000000000000000000000000000002222222000000000000000000000000000000002200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#LIST
#_FIELDEND
##FIELD
P1:x=995,y=575,h=26,w=75,alignment="N",f=SAVE_P,virtual=1,r=9,c="Speichern",v=1;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#ONCHANGE
Postform
#_FIELDEND
##FIELD
P1:x=10,y=575,h=26,w=160,alignment="N",f=IMPORT_P,virtual=1,r=10,c="Warnungen importieren",v=1;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#ONCHANGE
$Filename = OpenDialog('Bitte eine Datei auswählen', 'c:\', 'Nur CSV (*.csv)|*.csv') 

if($Filename ='')return


FileToMemo($Filename, £fileLines)
// Die Datei hat Titel, beginnen erst auf zeile zwei
%rowIndex = 2
%rows = MemoSize(£fileLines)
if(%rows < 2) return


clearMemo(£geneAgent)
clearMemo(£warning)

clearMemo(£fields)

// Erster Schritt: Daten in Memos einlesen
loop
  $row =GetMemoLine(£fileLines, %rowIndex)
  ParseDelimited($row,';',£fields)
  // Gene;Phenotype (Metabolizer);Product;WarningGerman1;WarningGerman2;URL
  $gene = GetMemoLine(£fields,1)
  $phenotype = GetMemoLine(£fields,2)
  $agent = GetMemoLine(£fields,3)
  $warningInfo = GetMemoLine(£fields,4)
  $warningAction = GetMemoLine(£fields,5)
  $url = GetMemoLine(£fields,6)  
  
  %phenotype = ExecSelect('select code from phoenix.appcode where TABELLE=30000 and text =<#QT><$phenotype><#QT>')
  // eine Gen-Produkt-Kombination als Identifikator für die MemoIniStruktur
  $geneAgent = '<$gene>_<$agent>'
  $geneAgentPhenotype = '<$geneAgent>_<$phenotype>'
  
  MemoIniWriteString(£geneAgent,$geneAgent,'Gene',$gene)
  MemoIniWriteString(£geneAgent,$geneAgent,'Agent',$agent)
  
  MemoIniWriteString(£warning, $geneAgentPhenotype, 'GeneAgent', $geneAgent)
  MemoIniWriteString(£warning, $geneAgentPhenotype, 'Phenotype', %phenotype)
  MemoIniWriteString(£warning, $geneAgentPhenotype, 'WarningInfo', $warningInfo)
  MemoIniWriteString(£warning, $geneAgentPhenotype, 'WarningAction', $warningAction)
  MemoIniWriteString(£warning, $geneAgentPhenotype, 'URL', $url)
  
  inc(%rowIndex)
until(%rowIndex > %rows)
 
// Zweiter Schritt: Daten in Datenbank schreiben.
$now =@Now
%erfid = @PersID

clearMemo(£GeneAgentsHeaders)
clearMemo(£WarningHeaders)
MemoIniReadSections(£geneAgent,£GeneAgentsHeaders)
ForEachGosub('saveGeneAgent',£GeneAgentsHeaders, $geneAgent)
MemoIniReadSections(£warning,£WarningHeaders)
ForEachGosub('saveWarning',£WarningHeaders, $warning)

MessageBox('Import erfolgreich!')

return



:saveGeneAgent
$gene = MemoIniReadString(£geneAgent, $geneAgent, 'Gene')
$agent = MemoIniReadString(£geneAgent, $geneAgent, 'Agent')
%id = GenNewID('BFHGENEAGENT')
$name = '<$gene> / <$agent>'
clearMemo(£parameters)
MemoIniWriteString(£parameters, 'P0', 'Type', #dadtString) 
MemoIniWriteString(£parameters, 'P0', 'Value', $gene) 
MemoIniWriteString(£parameters, 'P1', 'Type', #dadtString) 
MemoIniWriteString(£parameters, 'P1', 'Value', $agent) 
MemoIniWriteString(£parameters, 'P2', 'Type', #dadtInteger) 
MemoIniWriteString(£parameters, 'P2', 'Value', %id) 
MemoIniWriteString(£parameters, 'P3', 'Type', #dadtString) 
MemoIniWriteString(£parameters, 'P3', 'Value', $name) 

MemoIniWriteString(£parameters, 'P4', 'Type', #dadtInteger) 
MemoIniWriteString(£parameters, 'P4', 'Value', %erfid) 
MemoIniWriteString(£parameters, 'P5', 'Type', #dadtDateTime) 
MemoIniWriteString(£parameters, 'P5', 'Value', $now) 
MemoIniWriteString(£parameters, 'P6', 'Type', #dadtInteger) 
MemoIniWriteString(£parameters, 'P6', 'Value', %erfid) 
MemoIniWriteString(£parameters, 'P7', 'Type', #dadtDateTime) 
MemoIniWriteString(£parameters, 'P7', 'Value', $now) 

ExecSQL('insert into phoenix.BFH_GENEAGENT (gene_e, agent_e, GENEAGENT_N, GENEAGENT_E, erfid, erfdat, mutid,  mutdat) values (?,?,?,?,?,?,?,?)', £parameters)

// Wir aktualisieren die bisherigen Medikamenten-Verknüpfungen auf die neuste Version

clearMemo(£parameters)
MemoIniWriteString(£parameters, 'P0', 'Type', #dadtString) 
MemoIniWriteString(£parameters, 'P0', 'Value', $name) 
MemoIniWriteString(£parameters, 'P1', 'Type', #dadtString) 
MemoIniWriteString(£parameters, 'P1', 'Value', $name) 
ExecSQL('update phoenix.BFH_GENEAGENTTOPRODUCT set GENEAGENT_N = (select geneagent_n from phoenix.BFH_GENEAGENT where GENEAGENT_E=?) where GENEAGENT_E=?', £parameters)
// Die ID wird für die Verknüpfung mit der Warnung verwendet.
MemoIniWriteString(£geneAgent, $geneAgent, 'ID', %id)

return

:saveWarning

$geneAgent = MemoIniReadString(£warning, $warning, 'GeneAgent')
%geneAgent = MemoIniReadString(£geneAgent, $geneAgent, 'ID')
%phenotype = MemoIniReadString(£warning, $warning, 'Phenotype')
$warningInfo = MemoIniReadString(£warning, $warning, 'WarningInfo')
$warningAction = MemoIniReadString(£warning, $warning, 'WarningAction')
$url = MemoIniReadString(£warning, $warning, 'URL')

//Warntexte werden als Memo gespeichert.
%warningInfo =SetMemo($warningInfo)
%warningAction = SetMemo($warningAction)

%id = GenNewID('BFHWARNING')

clearMemo(£parameters)
MemoIniWriteString(£parameters, 'P0', 'Type', #dadtInteger) 
MemoIniWriteString(£parameters, 'P0', 'Value', %geneAgent)
MemoIniWriteString(£parameters, 'P1', 'Type', #dadtInteger) 
MemoIniWriteString(£parameters, 'P1', 'Value', %phenotype)
MemoIniWriteString(£parameters, 'P2', 'Type', #dadtInteger) 
MemoIniWriteString(£parameters, 'P2', 'Value', %warningInfo) 
MemoIniWriteString(£parameters, 'P3', 'Type', #dadtInteger) 
MemoIniWriteString(£parameters, 'P3', 'Value', %warningAction) 
MemoIniWriteString(£parameters, 'P4', 'Type', #dadtString) 
MemoIniWriteString(£parameters, 'P4', 'Value', $url) 
MemoIniWriteString(£parameters, 'P5', 'Type', #dadtInteger) 
MemoIniWriteString(£parameters, 'P5', 'Value', %id) 
MemoIniWriteString(£parameters, 'P6', 'Type', #dadtString) 
MemoIniWriteString(£parameters, 'P6', 'Value', $geneAgent) 

MemoIniWriteString(£parameters, 'P7', 'Type', #dadtInteger) 
MemoIniWriteString(£parameters, 'P7', 'Value', %erfid) 
MemoIniWriteString(£parameters, 'P8', 'Type', #dadtDateTime) 
MemoIniWriteString(£parameters, 'P8', 'Value', $now) 
MemoIniWriteString(£parameters, 'P9', 'Type', #dadtInteger) 
MemoIniWriteString(£parameters, 'P9', 'Value', %erfid) 
MemoIniWriteString(£parameters, 'P10', 'Type', #dadtDateTime) 
MemoIniWriteString(£parameters, 'P10', 'Value', $now) 

ExecSQL('insert into phoenix.BFH_WARNING (GENEAGENT_N, METABOLIZER_C, WARNINGTEXTINFO_M, WARNINGTEXTACTION_M, INFOURL_E, WARNING_N, GENEAGENT_E, erfid, erfdat, mutid,  mutdat) values (?,?,?,?,?,?,?,?,?,?,?)', £parameters)
return
#_FIELDEND
##FIELD
L1:x=10,y=5,h=16,w=104,alignment="N",parent="K1WARNING",f=GENEAGENT_L,c="Gen und Wirkstoff",transparent=1,sr=0,sa=2,almt=0,ly=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
L1:x=200,y=5,h=16,w=91,alignment="N",parent="K1WARNING",f=METABOLIZER_L,c="Metabolizer-Typ",transparent=1,sr=0,sa=2,almt=0,ly=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
L1:x=345,y=5,h=16,w=63,alignment="N",parent="K1WARNING",f=INFO_L,c="Information",transparent=1,sr=0,sa=2,almt=0,ly=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
L1:x=555,y=5,h=16,w=132,alignment="N",parent="K1WARNING",f=ACTION_L,c="Vorgeschlagene Aktion",transparent=1,sr=0,sa=2,almt=0,ly=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
L1:x=765,y=5,h=16,w=137,alignment="N",parent="K1WARNING",f=INFOURL_L,c="URL weitere Information",transparent=1,sr=0,sa=2,almt=0,ly=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
L1:x=10,y=5,h=16,w=104,alignment="N",parent="K1GENEAGENTTOPRODUCT",f=GENEAGENTMAPPING_L,c="Gen und Wirkstoff",transparent=1,sr=0,sa=2,almt=0,ly=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
L1:x=205,y=5,h=16,w=71,alignment="N",parent="K1GENEAGENTTOPRODUCT",f=MEDIKAMENT_L,c="Medikament",transparent=1,sr=0,sa=2,almt=0,ly=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
L1:x=10,y=5,h=16,w=48,alignment="N",parent="K1GENEAGENT",f=GENE_L,c="Gen",transparent=1,sr=0,sa=1,almt=0,ly=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
L1:x=160,y=5,h=16,w=51,alignment="N",parent="K1GENEAGENT",f=WIRKSTOFF_L,c="Wirkstoff",transparent=1,sr=0,sa=2,almt=0,ly=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
L1:x=335,y=5,h=16,w=155,alignment="N",parent="K1GENEAGENT",f=AUSWAHL_L,c="Gen-Wirkstoff-Kombination",transparent=1,sr=0,sa=2,almt=0,ly=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
[ENDEXPORT]
