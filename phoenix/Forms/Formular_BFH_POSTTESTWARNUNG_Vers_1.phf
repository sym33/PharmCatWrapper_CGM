[BEGINEXPORT]
##FORM
BFH_POSTTESTWARNUNG¦1¦Pharmakogenetische Posttestwarnung¦F¦147.87.117.94¦nKISDev¦01.12.2017 16:29:17¦25
#FORMACL
220000000000000000002000002020222200000022222000002000000020000000000000000000000000000000000000000000000000002222222000000000000000000000000000000002200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#FORMPROPERTY
A0:x=575,y=140,w=1053,h=446,v=0,blnUseSysHeader=1,pgFormat=0;
#ONENTER
{**
 * =================================================================== 
 *
 *    Copyright (c) 2017 Marwin Philips (MAP) & Kevin Tippenhauer (TIK), Bachelorthesis Medizininformatik
 *
 *
 *    Project: BA Thesis Pharmakogenetic CDSS
 * ===================================================================
 *
 * @context Script:BFH_SUBMITTESTFILES
 * 
 * ===================================================================
 * @created  		18.11.2017 MAP
 * @see      		Referenzen_auf_weitere_Infos
 * @edit     		Aenderungsdatum_und_Ersteller
 * 
 *
 *  @Info       Die Warnung, welche angezeigt wird, nachdem ein Medikament ausgewählt wurde, bei welchem der Patient einen Kontraindizierenden Marker hat.
 *
 *}

SetFieldAttribute($guiTable, 'FREETEXTREASONING_M', #atHidden, #boTrue)
SetFieldAttribute($guiTable, 'REASONINGOPTION_R', #atHidden, #boTrue)
SetFieldAttribute($guiTable, 'OK_P', #atEnabled, #boFalse)


// Die ganzen Parameter werden vom aufrufenden Script per insert gesetzt und können nun verwendet werden.

^vcfanalysedate = GetFormField($guiTable, 'VCFANALYSEDATE_Q')
^genomeanalyse= GetFormField($guiTable, 'GENOMEANALYSE_Q')


$genomAnalyse = FormatDateTime('dd.mm.yyyy', ^genomeanalyse)
$vcfAnalyse = FormatDateTime('dd.mm.yyyy', ^vcfanalysedate)
$name = GetPatientDetails(@patid, '<vorname> <name>')
$gene = GetFormField($guiTable, 'GENE_E')
$metabolizer = GetFormField($guiTable, 'METABOLIZER_E')
$genotyp =GetFormField($guiTable, 'GENOTYP_E')
$warningtextinfo = GetFormField($guiTable, 'WARNINGTEXTINFO_M')
$warningtextaction = GetFormField($guiTable, 'WARNINGTEXTACTION_M')

Replace($warningtextinfo, '|CR|', '<#cr>')
Replace($warningtextaction, '|CR|', '<#cr>')

SetCaption($guiTable, 'INFOTEXT_L', 'Basierend auf der Genomsequenzierung vom <$genomAnalyse> und der automatisch darauf angewendeten Analyse vom <$vcfAnalyse>, <#cr>hat <$name> folgenden genetischen Befund:')
SetCaption($guiTable, 'PHENOTYPE_L', '<$gene> <$genotyp> <$metabolizer>')
SetCaption($guiTable, 'WARNINGTEXTINFO_L', $warningtextinfo)
SetCaption($guiTable, 'WARNINGTEXTACTION_L', $warningtextaction)
#ONCANCEL
if(%saved = #boTrue) return(1)

PutFormField($guiTable,'WARNINGOPTION_R',0)
PostForm
#FORMVARS
$guiTable=BFH_POSTTESTWARNUNG
%saved=0
#FORMSCRIPTS
=*setVisibilityAndValidate=// Visibility setzen<%br%>%warnIndex = GetFormField($guiTable, 'WARNINGOPTION_R')<%br%>if(%warnIndex = 1)<%br%>  SetFieldAttribute($guiTable, 'REASONINGOPTION_R', #atHidden, #boFalse)<%br%>else<%br%>  SetFieldAttribute($guiTable, 'REASONINGOPTION_R', #atHidden, #boTrue)<%br%>  PutFormField($guiTable, 'REASONINGOPTION_R', '')<%br%>endif<%br%><%br%>%begruendungsIndex =GetFormField($guiTable, 'REASONINGOPTION_R')<%br%>if(%begruendungsIndex = 3)<%br%>  SetFieldAttribute($guiTable, 'FREETEXTREASONING_M', #atHidden, #boFalse)<%br%>else<%br%>  SetFieldAttribute($guiTable, 'FREETEXTREASONING_M', #atHidden, #boTrue)<%br%>  PutFormField($guiTable, 'FREETEXTREASONING_M', '')<%br%>endif<%br%><%br%>%active = #boFalse<%br%>// Ok-Button aktivieren<%br%>if(%warnIndex = -1)<%br%>  %active = #boFalse<%br%>else<%br%>  if(%warnIndex != 1)<%br%>    %active = #boTrue<%br%>  else<%br%>    if(%begruendungsIndex = -1)<%br%>      %active = #boFalse<%br%>    else<%br%>      if(%begruendungsIndex = 3)<%br%>        $text = GetFormField($guiTable, 'FREETEXTREASONING_M')<%br%>        if($text != '')<%br%>          %active = #boTrue<%br%>        else<%br%>          %active = #boFalse<%br%>        endif<%br%>      else<%br%>        %active = #boTrue<%br%>      endif<%br%>    endif<%br%>  endif<%br%>endif<%br%><%br%>SetFieldAttribute($guiTable, 'OK_P', #atEnabled, %active)
#_FORMEND
##TABLE
T1:n=BFH_POSTTESTWARNUNG,o=0,l=0;
#TABLEACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_TABLEEND
##FIELD
R1:x=400,y=230,h=131,w=641,alignment="N",f=REASONINGOPTION_R,r=11,c="Begründung *",options="Die Dosis wird angepasst|Der Patient verträgt das Medikament|Der Patient möchte dieses Medikament trotzdem|Andere",options2="|||",options3="|||",l=-1,o=1,bk=1;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#LIST
#ONCHANGE
CallLocal('setVisibilityAndValidate')
#_FIELDEND
##FIELD
P1:x=10,y=400,h=36,w=256,alignment="N",f=WEITEREINFO_P,virtual=1,r=8,c="Weitere Informationen zum Phänotyp",v=1,g=CGS_INFORMATION_20;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#ONCHANGE
debug
$url = GetFormField($guiTable, 'URL_E')
ShellExecute('open', 'cmd.exe', '/c start <$url>', '', #swHide)
#_FIELDEND
##FIELD
R1:x=10,y=230,h=76,w=366,alignment="N",f=WARNINGOPTION_R,r=9,c="Warnungsaktion *",options="Verordnung abbrechen|Verordnung wird trotzdem durchgeführt",options2="|",options3="|",l=-1,o=1,bk=1;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#LIST
#ONCHANGE
callLocal('setVisibilityAndValidate')
#_FIELDEND
##FIELD
P1:x=960,y=400,h=36,w=80,alignment="N",f=OK_P,virtual=1,r=10,c="OK",v=1,g=CGS_OKAY_24;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#ONCHANGE
Debug
%saved =#boTrue
PostForm
CloseWindow
#_FIELDEND
##FIELD
M1:x=485,y=325,h=25,w=541,alignment="N",f=FREETEXTREASONING_M,r=12,l=1,v=0,AutoGrow=0,fontdlg=,SpeechProcessing=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#LIST
#ONCHANGE
callLocal('setVisibilityAndValidate')
#_FIELDEND
##FIELD
M1:x=795,y=5,h=26,w=100,alignment="N",f=WARNINGTEXTINFO_M,r=13,l=1,v=0,AutoGrow=0,fontdlg=,color=8421376,SpeechProcessing=0;
#FIELDACL
440000000000000000004000004040444400000044444000004000000040000000000000000000000000000000000000000000000000004444444000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#LIST
#_FIELDEND
##FIELD
M1:x=795,y=35,h=26,w=100,alignment="N",f=WARNINGTEXTACTION_M,r=14,l=1,v=0,AutoGrow=0,fontdlg=,color=8421376,SpeechProcessing=0;
#FIELDACL
440000000000000000004000004040444400000044444000004000000040000000000000000000000000000000000000000000000000004444444000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#LIST
#_FIELDEND
##FIELD
E1:x=910,y=5,h=24,w=101,alignment="N",f=GENE_E,r=15,v=0,l=40,m=0,color=8421376;
#FIELDACL
440000000000000000004000004040444400000044444000004000000040000000000000000000000000000000000000000000000000004444444000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#LIST
#_FIELDEND
##FIELD
E1:x=910,y=35,h=24,w=100,alignment="N",f=METABOLIZER_E,r=16,v=0,l=40,m=0,color=8421376;
#FIELDACL
440000000000000000004000004040444400000044444000004000000040000000000000000000000000000000000000000000000000004444444000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#LIST
#_FIELDEND
##FIELD
N1:x=795,y=90,h=24,w=101,alignment="N",f=USERID_N,r=17,l=0,inc=1,v=1,color=8421376;
#FIELDACL
440000000000000000004000004040444400000044444000004000000040000000000000000000000000000000000000000000000000004444444000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
D1:x=795,y=65,h=24,w=101,alignment="N",f=DISPLAYTIME_Q,r=18,format="dd.mm.yyyy hh:nn",layout=0,showbutton=1,a=dtNone,color=8421376;
#FIELDACL
440000000000000000004000004040444400000044444000004000000040000000000000000000000000000000000000000000000000004444444000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
D1:x=910,y=65,h=24,w=100,alignment="N",f=VCFANALYSEDATE_Q,r=19,format="dd.mm.yyyy hh:nn",layout=0,showbutton=1,a=dtNone,color=8421376;
#FIELDACL
440000000000000000004000004040444400000044444000004000000040000000000000000000000000000000000000000000000000004444444000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
D1:x=910,y=90,h=24,w=100,alignment="N",f=GENOMEANALYSE_Q,r=20,format="dd.mm.yyyy hh:nn",layout=0,showbutton=1,a=dtNone,color=8421376;
#FIELDACL
440000000000000000004000004040444400000044444000004000000040000000000000000000000000000000000000000000000000004444444000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
E1:x=910,y=120,h=24,w=101,alignment="N",f=URL_E,r=21,v=0,l=200,m=0,color=8421376;
#FIELDACL
440000000000000000004000004040444400000044444000004000000040000000000000000000000000000000000000000000000000004444444000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#LIST
#_FIELDEND
##FIELD
E1:x=795,y=120,h=24,w=101,alignment="N",f=GENOTYP_E,r=22,v=0,l=40,m=0,color=8421376;
#FIELDACL
440000000000000000004000004040444400000044444000004000000040000000000000000000000000000000000000000000000000004444444000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#LIST
#_FIELDEND
##FIELD
L1:x=10,y=10,h=32,w=403,alignment="N",f=WARNUNG_L,c="Pharmakogenetische Warnung",transparent=1,font=Arial|[fsBold]|20|255,sr=0,sa=2,almt=0,ly=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
L1:x=10,y=55,h=21,w=666,alignment="N",f=INFOTEXT_L,c="Informationen zu Untersuchung (Datum Untersuchung, Datum Analyse)",transparent=1,sr=0,sa=1,almt=0,ly=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
L1:x=10,y=150,h=16,w=1001,alignment="N",f=WARNINGTEXTINFO_L,c="Risikotext",transparent=1,sr=0,sa=1,almt=0,ly=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
L1:x=10,y=105,h=24,w=170,alignment="N",f=PHENOTYPE_L,c="Gen + Metabolizer",transparent=1,font=Arial|[]|16|255,sr=0,sa=1,almt=0,ly=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
L1:x=10,y=170,h=61,w=1031,alignment="N",f=WARNINGTEXTACTION_L,c="Anweisung",transparent=1,font=Arial|[]|10|255,sr=0,sa=1,almt=0,ly=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
L1:x=295,y=410,h=16,w=558,alignment="N",f=FURTHERINFO_L,c="Bei Fragen konsultieren Sie die verknüpfte Guideline oder kontaktieren Sie die Pharmakogenetik.",transparent=1,sr=0,sa=2,almt=0,ly=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
##FIELD
L1:x=675,y=375,h=16,w=364,alignment="N",f=LABEL7,c="Diese Warnung ist nicht für den klinischen Gebrauch geeignet.",transparent=1,font=Arial|[fsItalic]|10|255,sr=0,sa=1,almt=0,ly=0;
#FIELDACL
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
#_FIELDEND
[ENDEXPORT]
